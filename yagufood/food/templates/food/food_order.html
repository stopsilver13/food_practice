{% extends "nav_footer.html" %}

{% load staticfiles %}


{% block title %}
    음식 주문
{% endblock %}

{% block head_extra %}


<style type="text/css">
    .picked-view {
        height: 800px;
    }

    .food-menu, .side-menu {
        display: inline-block;
        text-align: center;
        height: 200px;
        width: 200px;
    }

    .pick-food-navbar {
        vertical-align: top;
        font-size: 0;
        padding: 0;
        margin: 0;
    }

    .pick-food-navbar a.active {
        background-color: #b70000;
    }

    .pick-food-navbar a:hover {
        text-decoration: none;
    }

    .pick-food-navbar a:focus {
        text-decoration: none;
    }

    .pick-food-navbar a {
        display: inline-block;
        width: 25%;
        background-color: #e0e0e0;
        padding: 7px 10px;
        font-size: 17px;
        color: #ffffff;
        text-align: center;
        -webkit-border-radius: 25px 25px 0 0;
        -moz-border-radius: 25px 25px 0 0;
        border-radius: 20px 20px 0 0;
    }

    .what-i-picked {
        background-color: black;
        position: fixed;
        height: 250px;
        bottom: 0;
        width: 100%;
        color: white;
    }

    .what-i-picked > .food-menu, .what-i-picked > .side-menu {
        width:100px;
        display: inline-block;
        vertical-align: top;
    }

    button {
        width: 10px;
        color: black;
    }

    #total-price {
        float: right;
        margin-top: 75px;
    }

</style>
{% endblock %}

{% block content %}

<div class="content_in">
    <div class="pick-food-section">
        <div class="pick-food-navbar">
            <a href="#main" class="active" data-toggle="tab">1. 메인메뉴</a>
            <a href="#side" data-toggle="tab">2. 사이드</a>
            <a href="#drink" data-toggle="tab">3. 음료</a>
            <a href="#etc" data-toggle="tab">4. 기타</a>
        </div>

        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="main">
                <div class="picked-view">
            {% for menu in menus %}
                {% if menu.group == 'main' %}
                            <a class="pick-my-food"><div class="food-menu" id="menu-{{ menu.pk }}" value="{{ menu.pk }}">
                                <img src="{{ menu.photo.url }}" style="width:100%;">
                                <P style="margin-bottom: 0px">{{ menu.store }}</P>
                                <P style="margin-bottom: 0px">{{ menu.name }}</P>
                                <p id="price{{ menu.pk }}"><span>{{ menu.price }}</span>원</p>
                            </div></a>
                {% endif %}
            {% endfor %}

                </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="side">
                <div class="picked-view">

            {% for menu in menus %}
                {% if menu.group == 'side' %}
                            <a class="pick-my-food"><div class="food-menu" id="menu-{{ menu.pk }}" value="{{ menu.pk }}">
                                <img src="{{ menu.photo.url }}" style="width:100%;">
                                <P style="margin-bottom: 0px">{{ menu.store }}</P>
                                <P style="margin-bottom: 0px">{{ menu.name }}</P>
                                <p id="price{{ menu.pk }}"><span>{{ menu.price }}</span>원</p>
                            </div></a>
                {% endif %}
            {% endfor %}

                </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="drink">
                <div class="picked-view">

            {% for menu in menus %}
                {% if menu.group == 'drink' %}
                            <a class="pick-my-food"><div class="food-menu" id="menu-{{ menu.pk }}" value="{{ menu.pk }}">
                                <img src="{{ menu.photo.url }}" style="width:100%;">
                                <P style="margin-bottom: 0px">{{ menu.store }}</P>
                                <P style="margin-bottom: 0px">{{ menu.name }}</P>
                                <p id="price{{ menu.pk }}"><span>{{ menu.price }}</span>원</p>
                            </div></a>
                {% endif %}
            {% endfor %}

                </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="etc">
                <div class="picked-view">

            {% for menu in menus %}
                {% if menu.group == 'etc' %}
                            <a class="pick-my-food"><div class="food-menu" id="menu-{{ menu.pk }}" value="{{ menu.pk }}">
                                <img src="{{ menu.photo.url }}" style="width:100%;">
                                <P style="margin-bottom: 0px">{{ menu.store }}</P>
                                <P style="margin-bottom: 0px">{{ menu.name }}</P>
                                <p id="price{{ menu.pk }}"><span>{{ menu.price }}</span>원</p>
                            </div></a>
                {% endif %}
            {% endfor %}

                </div>
            </div>
        </div>
    </div>
</div>

    <div class="what-i-picked">
        <div id="total-price">
            총액: <span id="price-sum"></span>원
        </div>
    </div>


 <!-- 메인메뉴, 사이드, 음료 왔다갔다하는 네브 바-->
<script type="text/javascript">
    $('div.pick-food-navbar a').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show');
        $('div.pick-food-navbar a.active').removeClass('active');
        $(this).addClass('active');
    });

// 메뉴 클릭했을 때 작동
    var countclick_defalut = 1;
    var chongaek = 0;
    $('.pick-my-food').click(function(){
        var pickedid = $(this).children().attr("id");
        if($(".what-i-picked > #"+pickedid).length == 0) {           //장바구니에 메뉴가 없으면 추가
            $(this).children().clone().appendTo(".what-i-picked");
            $("<p><span id=" + pickedid + ">"+countclick_defalut+"</span>개</p><button class=sub-button-"+ pickedid +">-</button><button class=plus-button-"+ pickedid +">+</button>").insertAfter(".what-i-picked #price"+ $(this).children().attr('value'));   //갯수, +,-버튼 생성

        }   else {          //장바구니에 메뉴가 있으면 갯수 올라가게 하는 로직
            countclick = Number($('span#' + pickedid).html()) + 1;
            var price_per_unit = Number($(".pick-my-food #price"+ $(this).children().attr('value') + " span").html());
            $('span#' + pickedid).replaceWith("<span id=" + pickedid + ">"+countclick+"</span");
            $(".what-i-picked #price"+ $(this).children().attr('value') + " span").replaceWith("<span>"+(countclick*price_per_unit)+"</span");
        };

        // 총액 금액 반영
        chongaek = chongaek + Number($(".pick-my-food #price"+ $(this).children().attr('value') + " span").html());
        $("#price-sum").text(chongaek);

        //빼기버튼 누르면 갯수랑 금액 줄어들고 총액 반영까지
        $('.sub-button-'+ pickedid).unbind("click");
        $('.sub-button-'+ pickedid).click(function(){
            countclick = Number($('span#' + pickedid).html()) - 1;
            var price_per_unit = Number($(".pick-my-food #price"+ $(this).parent().attr('value') + " span").html());
            if(countclick == 0 ) {  // 갯수 0개 되면 알림뜨면서 메뉴 사라지고
                $('.sub-button-'+ pickedid).parent().remove();
                alert("해당 메뉴를 취소하였습니다")
            }
            $('span#' + pickedid).replaceWith("<span id=" + pickedid + ">"+countclick+"</span");
            $(".what-i-picked #price"+ $(this).parent().attr('value') + " span").replaceWith("<span>"+(countclick*price_per_unit)+"</span");
            chongaek = chongaek - Number($(".pick-my-food #price"+ $(this).parent().attr('value') + " span").html());
            $("#price-sum").text(chongaek);
        });

        //더하기 버튼 누르면 갯수랑 금액 올라가고 총액 반영까지
        $('.plus-button-'+ pickedid).unbind("click");
        $('.plus-button-'+ pickedid).click(function(){
            countclick = Number($('span#' + pickedid).html()) + 1;
            var price_per_unit = Number($(".pick-my-food #price"+ $(this).parent().attr('value') + " span").html());
            $('span#' + pickedid).replaceWith("<span id=" + pickedid + ">"+countclick+"</span");
            $(".what-i-picked #price"+ $(this).parent().attr('value') + " span").replaceWith("<span>"+(countclick*price_per_unit)+"</span");
            chongaek = chongaek + Number($(".pick-my-food #price"+ $(this).parent().attr('value') + " span").html());
            $("#price-sum").text(chongaek);
        });
    });

</script>

{% endblock %}